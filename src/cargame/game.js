var gameWidth=160,gameHeight=80,size=10,roadSize=6;function addStyle(){var e=document.createElement("STYLE");e.innerHTML="table,th,td { min-width: "+size+"px; height: "+size+"px; }",document.body.appendChild(e)}function grid(){var e=document.getElementById("game-container");e.innerHTML="";var r=document.getElementById("game-table");null===r&&(r=document.createElement("table"),r.id="game-table",e.appendChild(r));for(var n="<tbody>",t=0;t<gameHeight;t++){n+="<tr>";for(var a=0;a<gameWidth;a++)n+='<td data-p="'+a+","+t+'"></td>';n+="</tr>"}n+="</tbody>",r.innerHTML=n}function drawWithStyle(e,r){for(var n=0;n<e.length;n++)if("undefined"!==typeof e[n]){var t=document.querySelector('td[data-p="'+e[n][0]+","+e[n][1]+'"]');null!==t&&(t.className=r)}else console.log("points["+n+"] is undefined")}addStyle();var prevTx=-1,prevTy=-1;function drawPlayer(e,r){var n=[[e,r+1],[e+1,r+1],[e+2,r+1],[e+3,r+1],[e+4,r+1]],t=[[e,r],[e+3,r],[e,r+2],[e+3,r+2]],a=[[prevTx,prevTy],[prevTx+3,prevTy],[prevTx,prevTy+1],[prevTx+1,prevTy+1],[prevTx+2,prevTy+1],[prevTx+3,prevTy+1],[prevTx+4,prevTy+1],[prevTx,prevTy+2],[prevTx+3,prevTy+2]];-1===prevTx&&(a=[]),prevTx=e,prevTy=r,drawWithStyle(a,"road"),drawWithStyle(n,"car"),drawWithStyle(t,"wheel")}function random(e,r){return Math.floor(Math.random()*(r-e+1)+e)}var line=[];function generateLine(){for(var e=0;e<2*gameWidth;e++)line.push(Math.floor(gameHeight/2))}function undrawLine(){for(var e=document.querySelectorAll(".road,.red,.white"),r=0;r<e.length;r++)e[r].className=""}function fillRoadLine(e){for(var r=[],n=0;n<e.length;n++)for(var t=1-roadSize;t<roadSize;t++)r.push([e[n][0],e[n][1]+t]);return r}function fillEdgeLine(e){for(var r=[],n=0;n<e.length;n++)r.push([e[n][0],e[n][1]-roadSize]),r.push([e[n][0],e[n][1]+roadSize]);return r}function fillLinePoints(e){return e.filter((function(e,r){return r<gameWidth})).map((function(e,r){return[r,e]}))}function drawEdgeLine(e){var r=[],n=[],t=6,a=iter%t,i=[],l=[];0===a?(i=[0,1,2],l=[3,4,5]):1===a?(i=[0,1,5],l=[2,3,4]):2===a?(i=[0,4,5],l=[1,2,3]):3===a?(i=[3,4,5],l=[0,1,2]):4===a?(i=[2,3,4],l=[0,1,5]):5===a&&(i=[1,2,3],l=[0,4,5]),r=e.filter((function(e,r){var n=e[0]%t;return i.indexOf(n)>-1})),n=e.filter((function(e,r){var n=e[0]%t;return l.indexOf(n)>-1})),drawWithStyle(r,"red"),drawWithStyle(n,"white")}function drawLine(e){var r=fillLinePoints(e),n=fillRoadLine(r);drawWithStyle(n,"road");var t=fillEdgeLine(r);drawEdgeLine(t)}function moveLine(){line.shift(),line.push(Math.floor(gameHeight/2))}function bumpLine(){var e=gameWidth,r=e/2,n=e/4,t=gameHeight,a=t/2,i=random(0,t-1),l=i-a;if(i<a&&(l=a-i),i!==Math.floor(a)){var o=i,d=e+n,v=(i-a)/2+a;i<a&&(v=i+l/2);var f=r/l,p=e+r,h=v-f*(p-d);i<a&&(h=f*(p-d)+v);var u=o-h;i<a&&(u=h-o);Math.floor(t/2);for(var y=e+1;y<2*e-1;y++){var c=y;line[y]=Math.floor(Math.sqrt(u*u-(c-p)*(c-p))+h),i<a&&(line[y]=-Math.floor(Math.sqrt(u*u-(c-p)*(c-p))-h))}}else for(y=e+1;y<2*e-1;y++)line[y]=Math.floor(a)}function collision(){var e=playerTx,r=playerTy,n=[[e,r],[e+3,r],[e,r+1],[e+1,r+1],[e+2,r+1],[e+3,r+1],[e+4,r+1],[e,r+2],[e+3,r+2]],t=fillLinePoints([line[0],line[1],line[2],line[3],line[4],line[5]]),a=fillRoadLine(t).concat(fillEdgeLine(t)),i=!0;return n.forEach((function(e){var r=!1;a.forEach((function(n){e[0]===n[0]&&e[1]===n[1]&&(r=!0)})),r||(i=!1)})),!i}generateLine(),grid();var playerTx=1,playerTy=Math.floor(gameHeight/2),iter=0,speed=75,score=0;function gameLoop(){undrawLine(),iter%gameWidth===0&&0!==iter&&bumpLine(),moveLine(),drawLine(line),drawPlayer(playerTx,playerTy),iter%(3*gameWidth)===0&&0!==iter&&speed>5&&(speed=Math.floor(.8*speed),console.log("faster: "+speed),clearInterval(ival),ival=setInterval(gameLoop,speed)),collision()&&(console.log("collision"),clearInterval(ival)),iter++,score+=speed}var ival=setInterval(gameLoop,speed);function movePlayer(e){playerTy+=e,playerTy<0&&(playerTy=0),playerTy>gameHeight-3&&(playerTy=gameHeight-3)}document.addEventListener("keydown",(function(e){"w"===e.key?movePlayer(-1):"s"===e.key&&movePlayer(1)}));